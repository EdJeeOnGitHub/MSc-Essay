---
title: "Cleaning Angrist and Evans 1998"
author: "Ed Jee"
date: "22 January 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Importing and cleaning 1990 Census Data
```{r}
library(haven)
library(dplyr)
df_90 <- read_sas("AngEv98/AngEv98/m_d_903.sas7bdat")
```


Cleaning data according to Angrist and Evans SAS replication codes:
```{r}
df_90_clean <- df_90 %>%
  filter((AGEM <= 35) & (AGEM >= 21)) %>% 
  filter(KIDCOUNT >= 2) %>% 
  filter(AGE2NDK >= 1) %>% 
  filter(AAGE == "0" & AAGE2ND == "0" & ASEX == "0" & ASEX2ND == "0") %>% 
  mutate(fertdif = as.numeric(KIDCOUNT) - (as.numeric(FERTIL) - 1),
         agefstm = as.numeric(AGEM) - as.numeric(AGEK)) %>% 
  filter(agefstm >= 15) %>% 
  filter(PWGTM1 > 0) %>% 
  mutate(samesex = (SEXK == SEX2NDK),
         morekids = (KIDCOUNT > 2)) %>% 
  mutate(SEXK = as.numeric(SEXK),
         SEX2NDK = as.numeric(SEX2NDK),
         WEEK89D = as.numeric(WEEK89D),
         WEEK89M = as.numeric(WEEK89M)) %>% 
  rename_all(tolower)


df_90_subset <- df_90_clean %>% 
  rename(kid_age = agek,
         kid2_age = age2ndk,
         m_age = agem,
         d_age = aged) %>% 
  select(-starts_with("a")) %>% 
  mutate_at(c("racek",
              "birthplk",
              "schoolk",
              "state",
              "racem",
              "raced",
              "hispm",
              "hispd",
              "poverty",
              "pobm",
              "schoolm",
              "hispd",
              "pobd",
              "schoold"), factor) %>% 
  mutate_if(is.character, as.numeric)
  
  
  
df_90_subset %>% 
  skimr::skim()
```


```{r}
library(tidyr)
df_90_preapred <- df_90_subset %>% 
  drop_na() %>% 
  filter_if(is.numeric, all_vars(. >=0)) 

```




```{r}

```



# Recreating Table 5

```{r}
library(AER)
library(broom)


# worked_for_pay <- ivreg()

weeks_worked <- ivreg(week89m ~ morekids | samesex,
                      data = df_90_clean)
weeks_worked %>% summary()


hours_week <- ivreg(hour89m ~ morekids | samesex,
                    data = df_90_clean)
hours_week %>% summary()

labour_income <- ivreg(incomem1 ~ morekids | samesex,
                       data = df_90_clean)
labour_income %>% summary()
```

 
OLS of more than two kids on same sex 
```{r}
lm(morekids ~ samesex, data = df_90_clean) %>% summary()
```


```{r}
lm(morekids ~ sexk + sex2ndk + samesex + agem,  data =  df_90_clean) %>% summary()
```



```{r}
agem agek age2ndk marital kidcount racem;

proc reg;
 model morekids=samesex;

run;

```

